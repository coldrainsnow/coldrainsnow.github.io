---
layout: post
title: "从缺陷中学习C++"
tags: [C++, 读书笔记]
---

## 1.前言

之前我的博客中还写道，有一本C++踩坑经验的书就好了，站在前人的肩膀上更有效率的coding，还真被我遇到了

本来在读这本书的时候，没想写笔记，但是有时遇到挺有意思的问题时，就忍不住想记录下

## 2.宏展开问题

```cpp
#define SQR(x) ((x) * (x))

i = 3;
SQR(++i);
```

我们本意是要得到4*4=16

但其实展开后为4*5=20

总结：

C++ 语言的函数内联机制既具备宏代码的效率，又增加了安全性，而且可以自由操作类的

数据成员

在 C++ 程序中，应该用内联函数取代所有宏代码，只有"断言 assert"例外，assert

是仅在 Debug 版本起作用的宏，它用于检查"不应该"发生的情况。

## 3.整除的精度问题

```cpp
float result
result = 1/6;  // 0
```

正确的

```cpp
result = 1.0/6.0;
```

## 4.临时变量溢出

```cpp
long multiply(int m, int n)
{
    long score;
    score = m*n;
    return score;
}
```

当m,n都取1亿（在int范围内），这时候结果溢出，因为m\*n的结果会先保存在一个int的临时变量中，而这个m\*n的范围在long的范围内

正确的

```cpp
long multiply(int m, int n)
{
    long score;
    score = static_cast<long>(m)*static_cast<long>(n);
    return score;
}
```



